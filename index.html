<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>免費英文打字練習 | B1-C1級別線上英語打字訓練 | English Typing Practice</title>
    <meta name="description" content="免費線上英文打字練習工具，提供B1-C1級別英語句子練習。提升英文打字速度與準確率，包含中文翻譯與重點單字解釋。適合英語學習者、學生、上班族使用。">
    <meta name="keywords" content="英文打字, 英語打字練習, 線上打字, 免費打字練習, English typing, 打字速度測試, WPM測試, 英語學習, B1 B2 C1, 英文練習">
    <meta name="author" content="English Typing Practice">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="免費英文打字練習 | B1-C1級別線上英語打字訓練">
    <meta property="og:description" content="免費線上英文打字練習工具，提供B1-C1級別英語句子練習。提升英文打字速度與準確率，包含中文翻譯與重點單字解釋。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ben0126.github.io/english_typing_practice/">
    <meta property="og:image" content="https://ben0126.github.io/english_typing_practice/og-image.jpg">
    <meta property="og:locale" content="zh_TW">
    <meta property="og:site_name" content="English Typing Practice">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="免費英文打字練習 | B1-C1級別線上英語打字訓練">
    <meta name="twitter:description" content="免費線上英文打字練習工具，提供B1-C1級別英語句子練習。提升英文打字速度與準確率。">
    <meta name="twitter:image" content="https://ben0126.github.io/english_typing_practice/twitter-image.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://ben0126.github.io/english_typing_practice/">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "英文打字練習",
        "description": "免費線上英文打字練習工具，提供B1-C1級別英語句子練習",
        "url": "https://ben0126.github.io/english_typing_practice/",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "English Typing Practice"
        },
        "browserRequirements": "Requires JavaScript",
        "softwareVersion": "1.0",
        "isAccessibleForFree": true,
        "educationalLevel": "Intermediate to Advanced",
        "teaches": ["English Typing", "English Language", "Keyboard Skills"],
        "audience": {
            "@type": "EducationalAudience",
            "educationalRole": "student"
        }
    }
    </script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="msapplication-TileColor" content="#4CAF50">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@400;500;600&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(45deg, #4CAF50, #45a049);
            --secondary-gradient: linear-gradient(45deg, #2196F3, #1976D2);
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --progress-gradient: linear-gradient(90deg, #4CAF50, #45a049);
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background: var(--background-gradient);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: var(--primary-gradient);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .header .subtitle {
            font-size: 1em;
            opacity: 0.8;
            font-weight: 400;
        }

        .benefits {
            background: rgba(255,255,255,0.1);
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9em;
        }

        .benefits ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }

        .benefits li:before {
            content: "✓ ";
            color: #a8e6cf;
            font-weight: bold;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .difficulty-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            background: #e0e0e0;
            color: #333;
            font-weight: 500;
        }

        .difficulty-btn.active {
            background: #4CAF50;
            color: white;
            transform: scale(1.05);
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-left: auto;
            font-size: 14px;
            color: #666;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #4CAF50;
        }

        .practice-area {
            padding: 30px;
        }

        .sentence-display {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
        }

        .sentence {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 10px;
            user-select: none;
            font-family: 'Inter', sans-serif;
        }

        .char {
            position: relative;
        }

        .char.correct {
            background-color: #c8e6c9;
            color: #2e7d32;
        }

        .char.incorrect {
            background-color: #ffcdd2;
            color: #c62828;
        }

        .char.current {
            background-color: #2196F3;
            color: white;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 15px 0;
        }

        .audio-btn {
            background: var(--secondary-gradient);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .audio-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        }

        .audio-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .audio-btn.playing {
            background: var(--primary-gradient);
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }

        .speed-slider {
            width: 80px;
            height: 4px;
            border-radius: 2px;
            background: #ddd;
            outline: none;
            cursor: pointer;
        }

        .translation {
            font-size: 14px;
            color: #666;
            font-style: italic;
            margin-top: 8px;
        }

        .input-area {
            position: relative;
        }

        .typing-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            line-height: 1.6;
            resize: none;
            outline: none;
            transition: border-color 0.3s;
            font-family: 'Courier New', monospace;
        }

        .typing-input:focus {
            border-color: #4CAF50;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--progress-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        .vocabulary {
            margin-top: 20px;
            padding: 20px;
            background: #fff3e0;
            border-radius: 10px;
            border-left: 4px solid #ff9800;
        }

        .vocab-title {
            font-size: 16px;
            font-weight: bold;
            color: #e65100;
            margin-bottom: 10px;
        }

        .vocab-item {
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vocab-word {
            font-weight: bold;
            color: #d84315;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        .vocab-word:hover {
            color: #2196F3;
        }

        .word-audio-btn {
            background: #e3f2fd;
            border: none;
            border-radius: 12px;
            padding: 2px 6px;
            cursor: pointer;
            font-size: 12px;
            color: #1976D2;
            transition: all 0.2s;
        }

        .word-audio-btn:hover {
            background: #2196F3;
            color: white;
        }

        .next-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px auto;
            display: block;
            transition: transform 0.3s;
            font-weight: 500;
        }

        .next-btn:hover {
            transform: translateY(-2px);
        }

        .next-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            text-align: center;
            margin: 10px 0;
            font-size: 16px;
            font-weight: bold;
        }

        .feedback.excellent { color: #4CAF50; }
        .feedback.good { color: #2196F3; }
        .feedback.fair { color: #FF9800; }
        .feedback.poor { color: #f44336; }

        .features {
            background: #f8f9fa;
            padding: 30px;
            margin-top: 20px;
        }

        .features h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
            font-size: 1.8em;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .feature-card h3 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .feature-card p {
            color: #666;
            font-size: 0.9em;
        }

        .footer {
            background: #333;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 0.9em;
        }

        .footer p {
            margin-bottom: 5px;
        }

        .footer a {
            color: #4CAF50;
            text-decoration: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats {
                margin-left: 0;
                justify-content: center;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus indicators */
        .audio-btn:focus,
        .difficulty-btn:focus,
        .next-btn:focus,
        .word-audio-btn:focus {
            outline: 3px solid #2196F3;
            outline-offset: 2px;
        }

        .speed-slider:focus {
            outline: 3px solid #4CAF50;
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .char.correct {
                background-color: #000;
                color: #fff;
            }
            
            .char.incorrect {
                background-color: #fff;
                color: #000;
                border: 2px solid #000;
            }
            
            .char.current {
                background-color: #0000ff;
                color: #fff;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .char.current {
                animation: none;
                background-color: #1976D2;
            }
            
            .next-btn:hover,
            .audio-btn:hover {
                transform: none;
            }
            
            * {
                transition: none !important;
                animation: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🎯 免費英文打字練習</h1>
            <p>English Typing Practice | B1-C1 Level | 提升英語打字速度與準確率</p>
            <div class="subtitle">線上免費英文打字訓練工具，適合學生、上班族、英語學習者</div>
            <div class="benefits">
                <ul>
                    <li>完全免費使用</li>
                    <li>支援B1-C1三個級別</li>
                    <li>即時WPM速度測試</li>
                    <li>準確率統計分析</li>
                    <li>中文翻譯對照</li>
                    <li>重點單字解釋</li>
                </ul>
            </div>
        </header>

        <nav class="controls" role="navigation" aria-label="練習設定">
            <div class="difficulty-selector">
                <span>選擇難度:</span>
                <button class="difficulty-btn" data-level="B1" aria-label="選擇B1中級難度">B1 中級</button>
                <button class="difficulty-btn active" data-level="B2" aria-label="選擇B2中高級難度">B2 中高級</button>
                <button class="difficulty-btn" data-level="C1" aria-label="選擇C1高級難度">C1 高級</button>
            </div>
            <div class="stats" role="region" aria-label="打字統計">
                <div class="stat-item">
                    <span class="stat-value" id="wpm" aria-label="每分鐘字數">0</span>
                    <span>WPM</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="accuracy" aria-label="準確率">100%</span>
                    <span>準確率</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="progress" aria-label="練習進度">0/10</span>
                    <span>進度</span>
                </div>
            </div>
        </nav>

        <main class="practice-area" role="main">
            <section class="sentence-display" aria-label="練習句子">
                <div class="sentence" id="target-sentence" role="text" aria-label="目標句子" aria-live="polite"></div>
                <div class="audio-controls" role="group" aria-label="語音控制">
                    <button class="audio-btn" id="play-sentence" aria-label="播放完整句子" aria-describedby="play-sentence-desc">
                        🔊 播放句子
                    </button>
                    <div id="play-sentence-desc" class="sr-only">點擊播放當前英文句子的完整發音</div>
                    <button class="audio-btn" id="play-slow" aria-label="慢速播放句子" aria-describedby="play-slow-desc">
                        🐌 慢速播放
                    </button>
                    <div id="play-slow-desc" class="sr-only">點擊以較慢語速播放當前英文句子</div>
                    <div class="speed-control" role="group" aria-label="語速控制">
                        <label for="speed-slider">語速:</label>
                        <input type="range" class="speed-slider" id="speed-slider" min="0.3" max="1.5" step="0.1" value="0.9" aria-describedby="speed-value">
                        <span id="speed-value" aria-live="polite">0.9x</span>
                    </div>
                </div>
                <div class="translation" id="translation" aria-label="中文翻譯" aria-live="polite"></div>
            </section>

            <div class="progress-bar" role="progressbar" aria-label="打字進度">
                <div class="progress-fill" id="progress-fill"></div>
            </div>

            <div class="input-area">
                <label for="typing-input" class="sr-only">請在此輸入上方英文句子</label>
                <textarea 
                    class="typing-input" 
                    id="typing-input" 
                    placeholder="在此輸入上方英文句子..."
                    rows="3"
                    aria-describedby="feedback"
                    spellcheck="false"
                    autocomplete="off"
                    autocorrect="off"
                    autocapitalize="off"
                ></textarea>
            </div>

            <div class="feedback" id="feedback" role="status" aria-live="polite"></div>

            <button class="next-btn" id="next-btn" disabled aria-label="進入下一句練習">下一句 →</button>

            <section class="vocabulary" id="vocabulary" style="display: none;" aria-label="重點單字">
                <div class="vocab-title">📚 重點單字與片語</div>
                <div id="vocab-content"></div>
            </section>
        </main>

        <section class="features" id="features">
            <h2>為什麼選擇我們的英文打字練習？</h2>
            <div class="feature-grid">
                <article class="feature-card">
                    <h3>🎯 多級別練習</h3>
                    <p>提供B1、B2、C1三個級別的英文句子，從中級到高級循序漸進，適合不同程度的學習者。</p>
                </article>
                <article class="feature-card">
                    <h3>📊 即時統計</h3>
                    <p>即時顯示WPM（每分鐘字數）和準確率，幫助您追蹤打字速度和準確度的進步。</p>
                </article>
                <article class="feature-card">
                    <h3>🌏 雙語支援</h3>
                    <p>每個英文句子都配有中文翻譯，幫助理解句意，同時學習英語和提升打字技能。</p>
                </article>
                <article class="feature-card">
                    <h3>📚 單字學習</h3>
                    <p>重點單字標註和解釋，邊練習打字邊擴充英語詞彙量，一舉兩得。</p>
                </article>
                <article class="feature-card">
                    <h3>💻 跨平台支援</h3>
                    <p>支援電腦、平板、手機等各種設備，隨時隨地都能進行英文打字練習。</p>
                </article>
                <article class="feature-card">
                    <h3>🆓 完全免費</h3>
                    <p>無需註冊或付費，完全免費使用所有功能，讓每個人都能輕鬆提升英文打字能力。</p>
                </article>
                <article class="feature-card">
                    <h3>⌨️ 鍵盤快捷鍵</h3>
                    <p>支援豐富的鍵盤快捷鍵，提升操作效率：Ctrl+Enter 下一句，Ctrl+P 播放，Alt+1/2/3 切換級別。</p>
                </article>
                <article class="feature-card">
                    <h3>♿ 無障礙設計</h3>
                    <p>完整的 ARIA 標籤支援，高對比度模式，螢幕閱讀器友善，讓每個人都能輕鬆使用。</p>
                </article>
            </div>
        </section>

        <footer class="footer">
            <p>&copy; 2025 English Typing Practice. 英文打字練習工具 - 免費線上英語打字訓練</p>
            <p>適合學生、上班族、英語學習者使用 | <a href="#features">功能介紹</a> | <a href="mailto:contact@example.com">聯絡我們</a></p>
        </footer>
    </div>

    <script>
        class TypingPractice {
            constructor() {
                this.currentLevel = 'B2';
                this.currentSentenceIndex = 0;
                this.currentCharIndex = 0;
                this.startTime = null;
                this.errors = 0;
                this.totalChars = 0;
                this.completed = 0;
                this.speechRate = 0.9;
                this.currentSpeech = null;
                
                // Cache DOM elements for better performance
                this.elements = {};
                
                // Performance monitoring
                this.performanceMetrics = {
                    typingStartTime: null,
                    totalTypingTime: 0,
                    keystrokes: 0,
                    errors: 0
                };
                
                // Debounce utility
                this.debounce = (func, wait) => {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                };
                
                this.sentences = {
                    B1: [
                        {
                            text: "The weather forecast suggests that tomorrow will be significantly warmer than today.",
                            translation: "天氣預報顯示明天會比今天暖和得多。",
                            vocabulary: [
                                { word: "forecast", meaning: "預報" },
                                { word: "significantly", meaning: "顯著地" }
                            ]
                        },
                        {
                            text: "She decided to pursue a career in environmental science after watching a documentary.",
                            translation: "在看了一部紀錄片後，她決定從事環境科學的職業。",
                            vocabulary: [
                                { word: "pursue", meaning: "追求，從事" },
                                { word: "environmental", meaning: "環境的" },
                                { word: "documentary", meaning: "紀錄片" }
                            ]
                        },
                        {
                            text: "The restaurant manager apologized for the inconvenience caused by the delayed service.",
                            translation: "餐廳經理為延誤服務造成的不便道歉。",
                            vocabulary: [
                                { word: "apologized", meaning: "道歉" },
                                { word: "inconvenience", meaning: "不便" },
                                { word: "delayed", meaning: "延誤的" }
                            ]
                        },
                        {
                            text: "Regular exercise and a balanced diet are essential for maintaining good health.",
                            translation: "規律運動和均衡飲食對於維持良好健康是必不可少的。",
                            vocabulary: [
                                { word: "balanced", meaning: "均衡的" },
                                { word: "essential", meaning: "必不可少的" },
                                { word: "maintaining", meaning: "維持" }
                            ]
                        },
                        {
                            text: "The conference will focus on innovative solutions to address climate change challenges.",
                            translation: "這次會議將專注於應對氣候變化挑戰的創新解決方案。",
                            vocabulary: [
                                { word: "conference", meaning: "會議" },
                                { word: "innovative", meaning: "創新的" },
                                { word: "address", meaning: "應對，處理" }
                            ]
                        },
                        {
                            text: "Online learning platforms have become increasingly popular among students worldwide.",
                            translation: "線上學習平台在全世界的學生中越來越受歡迎。",
                            vocabulary: [
                                { word: "platforms", meaning: "平台" },
                                { word: "increasingly", meaning: "越來越" },
                                { word: "popular", meaning: "受歡迎的" }
                            ]
                        },
                        {
                            text: "The company implemented new security measures to protect customer information.",
                            translation: "公司實施了新的安全措施來保護客戶信息。",
                            vocabulary: [
                                { word: "implemented", meaning: "實施" },
                                { word: "measures", meaning: "措施" },
                                { word: "protect", meaning: "保護" }
                            ]
                        },
                        {
                            text: "Cultural diversity enriches our understanding of different perspectives and traditions.",
                            translation: "文化多樣性豐富了我們對不同觀點和傳統的理解。",
                            vocabulary: [
                                { word: "diversity", meaning: "多樣性" },
                                { word: "enriches", meaning: "豐富" },
                                { word: "perspectives", meaning: "觀點" }
                            ]
                        },
                        {
                            text: "Scientists continue to explore renewable energy sources as alternatives to fossil fuels.",
                            translation: "科學家們繼續探索可再生能源作為化石燃料的替代品。",
                            vocabulary: [
                                { word: "renewable", meaning: "可再生的" },
                                { word: "sources", meaning: "來源" },
                                { word: "alternatives", meaning: "替代品" }
                            ]
                        },
                        {
                            text: "The museum exhibition displays artifacts from ancient civilizations around the world.",
                            translation: "博物館展覽展示了來自世界各地古代文明的文物。",
                            vocabulary: [
                                { word: "exhibition", meaning: "展覽" },
                                { word: "artifacts", meaning: "文物" },
                                { word: "civilizations", meaning: "文明" }
                            ]
                        }
                    ],
                    B2: [
                        {
                            text: "The implementation of artificial intelligence in healthcare has revolutionized diagnostic procedures.",
                            translation: "人工智能在醫療保健領域的實施已經徹底改變了診斷程序。",
                            vocabulary: [
                                { word: "implementation", meaning: "實施" },
                                { word: "revolutionized", meaning: "徹底改變" },
                                { word: "diagnostic", meaning: "診斷的" }
                            ]
                        },
                        {
                            text: "Despite the challenging circumstances, the team demonstrated remarkable resilience and adaptability.",
                            translation: "儘管環境充滿挑戰，團隊展現了非凡的韌性和適應能力。",
                            vocabulary: [
                                { word: "circumstances", meaning: "環境，情況" },
                                { word: "remarkable", meaning: "非凡的" },
                                { word: "resilience", meaning: "韌性" },
                                { word: "adaptability", meaning: "適應能力" }
                            ]
                        },
                        {
                            text: "The sustainable development goals require collaborative efforts from governments and corporations worldwide.",
                            translation: "可持續發展目標需要全球政府和企業的合作努力。",
                            vocabulary: [
                                { word: "sustainable", meaning: "可持續的" },
                                { word: "collaborative", meaning: "合作的" },
                                { word: "corporations", meaning: "企業" }
                            ]
                        },
                        {
                            text: "Contemporary literature often explores themes of identity, belonging, and social transformation.",
                            translation: "當代文學經常探索身份認同、歸屬感和社會變革的主題。",
                            vocabulary: [
                                { word: "contemporary", meaning: "當代的" },
                                { word: "explores", meaning: "探索" },
                                { word: "transformation", meaning: "變革" }
                            ]
                        },
                        {
                            text: "The psychological impact of social media on adolescents has become a significant research focus.",
                            translation: "社交媒體對青少年心理影響已成為重要研究焦點。",
                            vocabulary: [
                                { word: "psychological", meaning: "心理的" },
                                { word: "adolescents", meaning: "青少年" },
                                { word: "significant", meaning: "重要的" }
                            ]
                        },
                        {
                            text: "Economic fluctuations demonstrate the interconnected nature of global financial markets.",
                            translation: "經濟波動顯示了全球金融市場的相互關聯性。",
                            vocabulary: [
                                { word: "fluctuations", meaning: "波動" },
                                { word: "interconnected", meaning: "相互關聯的" },
                                { word: "financial", meaning: "金融的" }
                            ]
                        },
                        {
                            text: "Technological advancements have fundamentally altered communication patterns across different generations.",
                            translation: "技術進步根本改變了不同世代之間的溝通模式。",
                            vocabulary: [
                                { word: "advancements", meaning: "進步" },
                                { word: "fundamentally", meaning: "根本地" },
                                { word: "generations", meaning: "世代" }
                            ]
                        },
                        {
                            text: "Archaeological discoveries continue to challenge our assumptions about ancient civilizations.",
                            translation: "考古發現持續挑戰我們對古代文明的假設。",
                            vocabulary: [
                                { word: "archaeological", meaning: "考古的" },
                                { word: "challenge", meaning: "挑戰" },
                                { word: "assumptions", meaning: "假設" }
                            ]
                        },
                        {
                            text: "The complexity of urban planning requires interdisciplinary collaboration among various stakeholders.",
                            translation: "城市規劃的複雜性需要各利益相關者之間的跨學科合作。",
                            vocabulary: [
                                { word: "complexity", meaning: "複雜性" },
                                { word: "interdisciplinary", meaning: "跨學科的" },
                                { word: "stakeholders", meaning: "利益相關者" }
                            ]
                        },
                        {
                            text: "Environmental conservation efforts must balance ecological protection with economic development needs.",
                            translation: "環境保護努力必須平衡生態保護與經濟發展需求。",
                            vocabulary: [
                                { word: "conservation", meaning: "保護" },
                                { word: "ecological", meaning: "生態的" },
                                { word: "development", meaning: "發展" }
                            ]
                        }
                    ],
                    C1: [
                        {
                            text: "The paradigm shift towards renewable energy necessitates comprehensive policy restructuring and substantial infrastructure investment.",
                            translation: "向可再生能源的範式轉變需要全面的政策重組和大量的基礎設施投資。",
                            vocabulary: [
                                { word: "paradigm shift", meaning: "範式轉變" },
                                { word: "necessitates", meaning: "需要，必須" },
                                { word: "comprehensive", meaning: "全面的" },
                                { word: "substantial", meaning: "大量的" }
                            ]
                        },
                        {
                            text: "The philosophical implications of consciousness studies intersect with neuroscience, cognitive psychology, and existential inquiry.",
                            translation: "意識研究的哲學意涵與神經科學、認知心理學和存在主義探究相互交織。",
                            vocabulary: [
                                { word: "implications", meaning: "意涵，含義" },
                                { word: "intersect", meaning: "相互交織" },
                                { word: "cognitive", meaning: "認知的" },
                                { word: "existential", meaning: "存在主義的" }
                            ]
                        },
                        {
                            text: "Quantum computing represents an unprecedented technological breakthrough with profound ramifications for cryptography and data processing.",
                            translation: "量子計算代表著前所未有的技術突破，對密碼學和數據處理具有深遠影響。",
                            vocabulary: [
                                { word: "unprecedented", meaning: "前所未有的" },
                                { word: "breakthrough", meaning: "突破" },
                                { word: "ramifications", meaning: "影響，後果" },
                                { word: "cryptography", meaning: "密碼學" }
                            ]
                        },
                        {
                            text: "The intricate interplay between genetic predisposition and environmental factors determines phenotypic expression in complex organisms.",
                            translation: "遺傳傾向與環境因素之間複雜的相互作用決定了複雜生物體的表現型表達。",
                            vocabulary: [
                                { word: "intricate", meaning: "複雜的" },
                                { word: "interplay", meaning: "相互作用" },
                                { word: "predisposition", meaning: "傾向" },
                                { word: "phenotypic", meaning: "表現型的" }
                            ]
                        },
                        {
                            text: "Postcolonial literary criticism examines the lingering effects of imperialism on cultural identity and narrative construction.",
                            translation: "後殖民文學批評檢視帝國主義對文化身份和敘事建構的持續影響。",
                            vocabulary: [
                                { word: "postcolonial", meaning: "後殖民的" },
                                { word: "lingering", meaning: "持續的" },
                                { word: "imperialism", meaning: "帝國主義" },
                                { word: "narrative", meaning: "敘事" }
                            ]
                        },
                        {
                            text: "Epistemological frameworks in empirical research methodology require rigorous scrutiny of assumptions underlying knowledge claims.",
                            translation: "實證研究方法論中的認識論框架需要對知識主張基礎假設進行嚴格審視。",
                            vocabulary: [
                                { word: "epistemological", meaning: "認識論的" },
                                { word: "empirical", meaning: "實證的" },
                                { word: "methodology", meaning: "方法論" },
                                { word: "scrutiny", meaning: "審視" }
                            ]
                        },
                        {
                            text: "The phenomenological approach to consciousness elucidates the subjective experience of temporality and intentionality.",
                            translation: "對意識的現象學方法闡明了時間性和意向性的主觀體驗。",
                            vocabulary: [
                                { word: "phenomenological", meaning: "現象學的" },
                                { word: "elucidates", meaning: "闡明" },
                                { word: "temporality", meaning: "時間性" },
                                { word: "intentionality", meaning: "意向性" }
                            ]
                        },
                        {
                            text: "Macroeconomic stabilization policies must accommodate heterogeneous market dynamics and asymmetric information structures.",
                            translation: "宏觀經濟穩定政策必須適應異質市場動態和非對稱信息結構。",
                            vocabulary: [
                                { word: "macroeconomic", meaning: "宏觀經濟的" },
                                { word: "heterogeneous", meaning: "異質的" },
                                { word: "asymmetric", meaning: "非對稱的" },
                                { word: "structures", meaning: "結構" }
                            ]
                        },
                        {
                            text: "Neuroplasticity research demonstrates the brain's capacity for synaptic reorganization throughout the human lifespan.",
                            translation: "神經可塑性研究證明了大腦在人類整個生命週期中突觸重組的能力。",
                            vocabulary: [
                                { word: "neuroplasticity", meaning: "神經可塑性" },
                                { word: "synaptic", meaning: "突觸的" },
                                { word: "reorganization", meaning: "重組" },
                                { word: "lifespan", meaning: "生命週期" }
                            ]
                        },
                        {
                            text: "Poststructuralist discourse analysis deconstructs hegemonic narratives to reveal underlying power dynamics.",
                            translation: "後結構主義話語分析解構霸權敘事以揭示潛在的權力動態。",
                            vocabulary: [
                                { word: "poststructuralist", meaning: "後結構主義的" },
                                { word: "deconstructs", meaning: "解構" },
                                { word: "hegemonic", meaning: "霸權的" },
                                { word: "dynamics", meaning: "動態" }
                            ]
                        }
                    ]
                };
                
                this.init();
            }

            init() {
                this.cacheElements();
                this.bindEvents();
                this.loadSentence();
                this.initSpeech();
                this.initPerformanceMonitoring();
                this.trackUserEngagement();
            }

            cacheElements() {
                // Cache frequently used DOM elements
                this.elements = {
                    input: document.getElementById('typing-input'),
                    nextBtn: document.getElementById('next-btn'),
                    playSentenceBtn: document.getElementById('play-sentence'),
                    playSlowBtn: document.getElementById('play-slow'),
                    speedSlider: document.getElementById('speed-slider'),
                    speedValue: document.getElementById('speed-value'),
                    wpm: document.getElementById('wpm'),
                    accuracy: document.getElementById('accuracy'),
                    progress: document.getElementById('progress'),
                    progressFill: document.getElementById('progress-fill'),
                    feedback: document.getElementById('feedback'),
                    targetSentence: document.getElementById('target-sentence'),
                    translation: document.getElementById('translation'),
                    vocabulary: document.getElementById('vocabulary'),
                    vocabContent: document.getElementById('vocab-content')
                };
            }

            initSpeech() {
                // Check if speech synthesis is available
                if ('speechSynthesis' in window) {
                    this.speechAvailable = true;
                } else {
                    this.speechAvailable = false;
                    console.log('Speech synthesis not available');
                }
            }

            initPerformanceMonitoring() {
                // Monitor typing performance
                this.performanceMetrics.typingStartTime = Date.now();
                
                // Monitor page load performance
                if ('performance' in window) {
                    window.addEventListener('load', () => {
                        setTimeout(() => {
                            const perfData = performance.getEntriesByType('navigation')[0];
                            const timing = {
                                domContentLoaded: perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart,
                                loadComplete: perfData.loadEventEnd - perfData.loadEventStart,
                                totalLoadTime: perfData.loadEventEnd - perfData.fetchStart
                            };
                            
                            console.log('Performance Metrics:', timing);
                            this.trackEvent('performance_metrics', timing);
                        }, 0);
                    });
                }

                // Monitor typing accuracy and speed
                this.performanceObserver = new PerformanceObserver((list) => {
                    for (const entry of list.getEntries()) {
                        if (entry.entryType === 'measure') {
                            console.log(`${entry.name}: ${entry.duration}ms`);
                            this.trackEvent('performance_measure', {
                                name: entry.name,
                                duration: entry.duration
                            });
                        }
                    }
                });

                try {
                    this.performanceObserver.observe({ entryTypes: ['measure'] });
                } catch (e) {
                    console.log('Performance Observer not supported');
                }

                // Monitor memory usage (if available)
                if ('memory' in performance) {
                    setInterval(() => {
                        const memoryInfo = {
                            usedJSHeapSize: performance.memory.usedJSHeapSize,
                            totalJSHeapSize: performance.memory.totalJSHeapSize,
                            jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
                        };
                        
                        // Only log if memory usage is high
                        if (memoryInfo.usedJSHeapSize / memoryInfo.jsHeapSizeLimit > 0.8) {
                            console.warn('High memory usage detected:', memoryInfo);
                            this.trackEvent('high_memory_usage', memoryInfo);
                        }
                    }, 30000); // Check every 30 seconds
                }
            }

            trackUserEngagement() {
                // Track typing sessions for analytics (if implemented)
                let sessionStart = Date.now();
                let totalTyped = 0;
                
                window.addEventListener('beforeunload', () => {
                    // Could send analytics data here
                    const sessionDuration = (Date.now() - sessionStart) / 1000;
                    localStorage.setItem('lastSession', JSON.stringify({
                        duration: sessionDuration,
                        typed: totalTyped,
                        level: this.currentLevel,
                        date: new Date().toISOString()
                    }));
                });
            }

            bindEvents() {
                // Difficulty selection
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelector('.difficulty-btn.active').classList.remove('active');
                        e.target.classList.add('active');
                        this.currentLevel = e.target.dataset.level;
                        this.currentSentenceIndex = 0;
                        this.completed = 0;
                        this.loadSentence();
                        
                        // Analytics tracking
                        this.trackEvent('difficulty_changed', { level: this.currentLevel });
                    });
                });

                // Typing input with debounce
                const debouncedTyping = this.debounce((value) => {
                    this.handleTyping(value);
                }, 50); // 50ms debounce for smooth typing
                
                this.elements.input.addEventListener('input', (e) => {
                    this.performanceMetrics.keystrokes++;
                    debouncedTyping(e.target.value);
                });

                this.elements.input.addEventListener('keydown', (e) => {
                    if (e.key === 'Tab') {
                        e.preventDefault();
                    }
                });

                this.elements.input.addEventListener('focus', () => {
                    this.trackEvent('input_focused');
                });

                // Next button
                this.elements.nextBtn.addEventListener('click', () => {
                    this.nextSentence();
                    this.trackEvent('next_sentence', { 
                        level: this.currentLevel, 
                        sentence: this.currentSentenceIndex 
                    });
                });

                // Speech controls
                this.elements.playSentenceBtn.addEventListener('click', () => {
                    this.speakText(this.sentences[this.currentLevel][this.currentSentenceIndex].text, this.speechRate);
                });

                this.elements.playSlowBtn.addEventListener('click', () => {
                    this.speakText(this.sentences[this.currentLevel][this.currentSentenceIndex].text, 0.6);
                });

                this.elements.speedSlider.addEventListener('input', (e) => {
                    this.speechRate = parseFloat(e.target.value);
                    this.elements.speedValue.textContent = this.speechRate + 'x';
                });

                // Enhanced keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Prevent default for our custom shortcuts
                    if (e.ctrlKey || e.altKey) {
                        switch (e.key) {
                            case 'Enter':
                                if (e.ctrlKey) {
                                    e.preventDefault();
                                    if (!this.elements.nextBtn.disabled) {
                                        this.nextSentence();
                                    }
                                }
                                break;
                            case 'p':
                                if (e.ctrlKey) {
                                    e.preventDefault();
                                    this.elements.playSentenceBtn.click();
                                }
                                break;
                            case 's':
                                if (e.ctrlKey) {
                                    e.preventDefault();
                                    this.elements.playSlowBtn.click();
                                }
                                break;
                            case '1':
                                if (e.altKey) {
                                    e.preventDefault();
                                    document.querySelector('[data-level="B1"]').click();
                                }
                                break;
                            case '2':
                                if (e.altKey) {
                                    e.preventDefault();
                                    document.querySelector('[data-level="B2"]').click();
                                }
                                break;
                            case '3':
                                if (e.altKey) {
                                    e.preventDefault();
                                    document.querySelector('[data-level="C1"]').click();
                                }
                                break;
                            case 'Tab':
                                // Enhanced tab navigation
                                if (e.shiftKey) {
                                    this.focusPreviousElement();
                                } else {
                                    this.focusNextElement();
                                }
                                e.preventDefault();
                                break;
                            case 'Escape':
                                e.preventDefault();
                                this.elements.input.focus();
                                break;
                        }
                    }
                    
                    // Space bar to play/pause audio when focused on audio controls
                    if (e.key === ' ' && e.target.classList.contains('audio-btn')) {
                        e.preventDefault();
                        e.target.click();
                    }
                });
            }

            focusNextElement() {
                const focusableElements = this.getFocusableElements();
                const currentIndex = focusableElements.indexOf(document.activeElement);
                const nextIndex = (currentIndex + 1) % focusableElements.length;
                focusableElements[nextIndex].focus();
            }

            focusPreviousElement() {
                const focusableElements = this.getFocusableElements();
                const currentIndex = focusableElements.indexOf(document.activeElement);
                const prevIndex = currentIndex === 0 ? focusableElements.length - 1 : currentIndex - 1;
                focusableElements[prevIndex].focus();
            }

            getFocusableElements() {
                const focusableSelectors = [
                    'button:not([disabled])',
                    'input:not([disabled])',
                    'textarea:not([disabled])',
                    'select:not([disabled])',
                    'a[href]',
                    '[tabindex]:not([tabindex="-1"])'
                ];
                
                return Array.from(document.querySelectorAll(focusableSelectors.join(', ')))
                    .filter(element => {
                        return element.offsetParent !== null && // Element is visible
                               !element.hasAttribute('aria-hidden') &&
                               element.getAttribute('tabindex') !== '-1';
                    });
            }

            trackEvent(eventName, data = {}) {
                // Simple event tracking (could be replaced with Google Analytics)
                try {
                    if (typeof gtag !== 'undefined') {
                        gtag('event', eventName, data);
                    }
                } catch (e) {
                    // Silently fail if analytics not available
                }
            }

            speakText(text, rate = 0.9) {
                if (!this.speechAvailable) {
                    alert('抱歉，您的瀏覽器不支援語音功能');
                    return;
                }

                // Cancel any ongoing speech
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = rate;
                utterance.pitch = 1;
                utterance.volume = 0.8;

                // Visual feedback
                const playBtn = this.elements.playSentenceBtn;
                const slowBtn = this.elements.playSlowBtn;
                
                utterance.onstart = () => {
                    if (rate > 0.7) {
                        playBtn.textContent = '⏸️ 播放中...';
                        playBtn.classList.add('playing');
                    } else {
                        slowBtn.textContent = '⏸️ 慢速播放中...';
                        slowBtn.classList.add('playing');
                    }
                };

                utterance.onend = () => {
                    playBtn.textContent = '🔊 播放句子';
                    slowBtn.textContent = '🐌 慢速播放';
                    playBtn.classList.remove('playing');
                    slowBtn.classList.remove('playing');
                };

                utterance.onerror = () => {
                    playBtn.textContent = '🔊 播放句子';
                    slowBtn.textContent = '🐌 慢速播放';
                    playBtn.classList.remove('playing');
                    slowBtn.classList.remove('playing');
                    console.log('Speech synthesis error');
                };

                this.currentSpeech = utterance;
                speechSynthesis.speak(utterance);
            }

            loadSentence() {
                const sentences = this.sentences[this.currentLevel];
                if (this.currentSentenceIndex >= sentences.length) {
                    this.currentSentenceIndex = 0;
                }
                
                const current = sentences[this.currentSentenceIndex];
                const sentenceElement = this.elements.targetSentence;
                const translationElement = this.elements.translation;
                const vocabElement = this.elements.vocabulary;
                const vocabContent = this.elements.vocabContent;

                // Display sentence with individual characters
                sentenceElement.innerHTML = current.text
                    .split('')
                    .map(char => `<span class="char">${char === ' ' ? '&nbsp;' : char}</span>`)
                    .join('');

                translationElement.textContent = current.translation;

                // Show vocabulary with audio buttons
                vocabContent.innerHTML = current.vocabulary
                    .map(item => `
                        <div class="vocab-item">
                            <span class="vocab-word" onclick="typingPractice.speakText('${item.word}', 0.8)">${item.word}</span>
                            <button class="word-audio-btn" onclick="typingPractice.speakText('${item.word}', 0.8)">🔊</button>
                            : ${item.meaning}
                        </div>
                    `).join('');
                vocabElement.style.display = 'block';

                // Reset input and states
                this.elements.input.value = '';
                this.elements.input.focus();
                this.elements.nextBtn.disabled = true;
                this.elements.feedback.textContent = '';
                this.currentCharIndex = 0;
                this.startTime = null;
                this.errors = 0;
                this.totalChars = current.text.length;

                this.updateProgress();
                this.updateCharacterDisplay();
                
                // Stop any ongoing speech
                if (this.currentSpeech) {
                    speechSynthesis.cancel();
                }
                
                // Update page title for SEO
                document.title = `英文打字練習 ${this.currentLevel}級 - 句子 ${this.currentSentenceIndex + 1} | English Typing Practice`;
            }

            handleTyping(inputValue) {
                performance.mark('typing-start');
                
                if (!this.startTime && inputValue.length > 0) {
                    this.startTime = Date.now();
                    this.performanceMetrics.typingStartTime = this.startTime;
                }

                const targetText = this.sentences[this.currentLevel][this.currentSentenceIndex].text;
                const chars = document.querySelectorAll('.char');

                // Reset all character classes
                chars.forEach(char => {
                    char.classList.remove('correct', 'incorrect', 'current');
                });

                let correctChars = 0;
                let hasError = false;

                // Check each character
                for (let i = 0; i < Math.max(inputValue.length, targetText.length); i++) {
                    if (i < inputValue.length && i < targetText.length) {
                        if (inputValue[i] === targetText[i]) {
                            chars[i].classList.add('correct');
                            correctChars++;
                        } else {
                            chars[i].classList.add('incorrect');
                            hasError = true;
                            if (i >= this.currentCharIndex) {
                                this.errors++;
                                this.performanceMetrics.errors++;
                                this.currentCharIndex = i + 1;
                            }
                        }
                    }
                }

                // Mark current character
                if (inputValue.length < targetText.length) {
                    chars[inputValue.length].classList.add('current');
                }

                // Update stats in real-time
                if (this.startTime && inputValue.length > 0) {
                    this.updateStats(inputValue.length, correctChars);
                }

                // Check if completed
                if (inputValue === targetText) {
                    this.completeCurrentSentence();
                }
                
                performance.mark('typing-end');
                performance.measure('typing-processing', 'typing-start', 'typing-end');
            }

            updateStats(typedLength, correctChars) {
                if (this.startTime && typedLength > 0) {
                    const timeElapsed = (Date.now() - this.startTime) / 1000 / 60; // minutes
                    // Calculate net WPM (subtract errors)
                    const netWPM = Math.max(0, Math.round(((correctChars) / 5) / timeElapsed)) || 0;
                    
                    this.elements.wpm.textContent = netWPM;
                }

                const accuracy = typedLength > 0 ? Math.round((correctChars / typedLength) * 100) : 100;
                this.elements.accuracy.textContent = accuracy + '%';
            }

            completeCurrentSentence() {
                this.completed++;
                this.elements.nextBtn.disabled = false;
                
                const accuracy = parseInt(this.elements.accuracy.textContent);
                const wpm = parseInt(this.elements.wpm.textContent);
                
                let feedback = '';
                let feedbackClass = '';
                
                if (accuracy >= 98 && wpm >= 40) {
                    feedback = '🌟 優秀！準確率和速度都很棒！';
                    feedbackClass = 'excellent';
                } else if (accuracy >= 95 && wpm >= 30) {
                    feedback = '👍 很好！繼續保持！';
                    feedbackClass = 'good';
                } else if (accuracy >= 90 && wpm >= 20) {
                    feedback = '📈 不錯！還有進步空間！';
                    feedbackClass = 'fair';
                } else {
                    feedback = '💪 繼續練習，你會越來越好的！';
                    feedbackClass = 'poor';
                }
                
                const feedbackElement = this.elements.feedback;
                feedbackElement.textContent = feedback;
                feedbackElement.className = 'feedback ' + feedbackClass;

                this.updateProgress();
                
                // Track completion
                this.trackEvent('sentence_completed', {
                    level: this.currentLevel,
                    sentence: this.currentSentenceIndex,
                    wpm: wpm,
                    accuracy: accuracy,
                    time: this.startTime ? (Date.now() - this.startTime) / 1000 : 0
                });
            }

            nextSentence() {
                this.currentSentenceIndex++;
                if (this.currentSentenceIndex >= this.sentences[this.currentLevel].length) {
                    this.currentSentenceIndex = 0;
                    
                    // Track level completion
                    this.trackEvent('level_completed', {
                        level: this.currentLevel,
                        totalSentences: this.sentences[this.currentLevel].length
                    });
                }
                this.loadSentence();
            }

            updateProgress() {
                const total = this.sentences[this.currentLevel].length;
                const current = this.currentSentenceIndex + 1;
                this.elements.progress.textContent = `${current}/${total}`;
                
                const percentage = (current / total) * 100;
                this.elements.progressFill.style.width = percentage + '%';
            }

            updateCharacterDisplay() {
                const chars = document.querySelectorAll('.char');
                chars.forEach((char, index) => {
                    if (index === 0) {
                        char.classList.add('current');
                    }
                });
            }
        }

        // Initialize the app
        let typingPractice;
        document.addEventListener('DOMContentLoaded', () => {
            typingPractice = new TypingPractice();
            
            // Service Worker for PWA capabilities
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available, show update notification
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('Service Worker registration failed:', error);
                    });
                
                // Listen for service worker messages
                navigator.serviceWorker.addEventListener('message', (event) => {
                    if (event.data && event.data.type === 'CACHE_UPDATED') {
                        console.log('Cache updated:', event.data.version);
                    }
                });
            }
        });

        // Update notification function
        function showUpdateNotification() {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification('英文打字練習更新', {
                    body: '新版本已準備就緒，點擊重新載入頁面以使用最新功能！',
                    icon: '/icons/icon-192x192.png',
                    tag: 'app-update',
                    requireInteraction: true,
                    actions: [
                        {
                            action: 'reload',
                            title: '重新載入'
                        },
                        {
                            action: 'dismiss',
                            title: '稍後'
                        }
                    ]
                });
                
                notification.onclick = () => {
                    window.location.reload();
                    notification.close();
                };
                
                // Auto-close after 10 seconds
                setTimeout(() => {
                    notification.close();
                }, 10000);
            }
        }

        // Performance optimization
        window.addEventListener('load', () => {
            // Preload critical resources for better performance
            if (typingPractice && typingPractice.speechAvailable) {
                // Preload speech synthesis voices
                speechSynthesis.getVoices();
            }
            
            // Request notification permission for PWA features
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });
    </script>

    <!-- Schema markup for better SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Course",
        "name": "免費英文打字練習課程",
        "description": "提供B1到C1級別的英文打字練習，包含WPM測試、準確率統計和詞彙學習",
        "provider": {
            "@type": "Organization",
            "name": "English Typing Practice"
        },
        "educationalLevel": ["Intermediate", "Upper-Intermediate", "Advanced"],
        "teaches": ["English Typing", "Keyboard Skills", "English Vocabulary"],
        "courseMode": "online",
        "isAccessibleForFree": true,
        "inLanguage": ["zh-TW", "en"],
        "coursePrerequisites": "基礎英語能力",
        "timeRequired": "PT15M",
        "typicalAgeRange": "13-99",
        "audience": {
            "@type": "EducationalAudience",
            "educationalRole": ["student", "self-learner"]
        }
    }
    </script>

    <!-- FAQ Schema for rich snippets -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "這個英文打字練習網站是免費的嗎？",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "是的，我們的英文打字練習網站完全免費，無需註冊或付費即可使用所有功能。"
                }
            },
            {
                "@type": "Question", 
                "name": "有哪些難度級別可以選擇？",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "我們提供B1（中級）、B2（中高級）、C1（高級）三個級別的英文句子練習，適合不同程度的學習者。"
                }
            },
            {
                "@type": "Question",
                "name": "如何提升英文打字速度？",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "建議每天練習15-30分鐘，專注於準確率而非速度，熟悉鍵盤位置後速度自然會提升。我們的工具會即時顯示WPM和準確率幫助您追蹤進度。"
                }
            }
        ]
    }
    </script>
</body>
</html>
